<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <style>
    #ui {
      position: fixed;
      left: 12px;
      bottom: 12px;
      z-index: 10;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    button {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #333;
      background: rgba(255, 255, 255, 0.9);
    }
  </style>
</head>

<body style="margin:0; overflow:hidden;">
  <div id="ui">
    <button id="freezeBtn">Freeze (place it)</button>
    <button id="resetBtn">Reset</button>
  </div>

  <a-scene embedded arjs>
    <a-assets>
      <img id="p1" src="img/photo1.jpg">
      <img id="p2" src="img/photo2.jpg">
      <img id="p3" src="img/photo3.jpg">
      <img id="p4" src="img/photo4.jpg">
      <img id="p5" src="img/photo5.jpg">
      <img id="p6" src="img/photo6.jpg">
    </a-assets>

    <!-- MARKER TRACKED GROUP -->
    <a-marker id="hiroMarker" preset="hiro">
      <!-- This cube follows the marker while it is visible -->
      <a-entity id="markerCube" material="side: double">
        <!-- Small cube for stable tracking: S=0.6, half=0.3 -->
        <a-plane src="#p1" position="0 0 0.301" rotation="0 0 0" width="0.6" height="0.6"></a-plane>
        <a-plane src="#p2" position="0 0 -0.301" rotation="0 180 0" width="0.6" height="0.6"></a-plane>
        <a-plane src="#p3" position="0.301 0 0" rotation="0 -90 0" width="0.6" height="0.6"></a-plane>
        <a-plane src="#p4" position="-0.301 0 0" rotation="0 90 0" width="0.6" height="0.6"></a-plane>
        <a-plane src="#p5" position="0 0.301 0" rotation="-90 0 0" width="0.6" height="0.6"></a-plane>
        <a-plane src="#p6" position="0 -0.301 0" rotation="90 0 0" width="0.6" height="0.6"></a-plane>
      </a-entity>
    </a-marker>

    <!-- FROZEN / WORLD GROUP -->
    <!-- This cube stays in one place (after you freeze) -->
    <a-entity id="frozenCube" visible="false" material="side: double">
      <a-plane src="#p1" position="0 0 0.301" rotation="0 0 0" width="0.6" height="0.6"></a-plane>
      <a-plane src="#p2" position="0 0 -0.301" rotation="0 180 0" width="0.6" height="0.6"></a-plane>
      <a-plane src="#p3" position="0.301 0 0" rotation="0 -90 0" width="0.6" height="0.6"></a-plane>
      <a-plane src="#p4" position="-0.301 0 0" rotation="0 90 0" width="0.6" height="0.6"></a-plane>
      <a-plane src="#p5" position="0 0.301 0" rotation="-90 0 0" width="0.6" height="0.6"></a-plane>
      <a-plane src="#p6" position="0 -0.301 0" rotation="90 0 0" width="0.6" height="0.6"></a-plane>
    </a-entity>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const marker = document.getElementById("hiroMarker");
    const markerCube = document.getElementById("markerCube");
    const frozenCube = document.getElementById("frozenCube");

    const freezeBtn = document.getElementById("freezeBtn");
    const resetBtn = document.getElementById("resetBtn");

    // Copies marker's world pose onto the frozen cube
    function freezePose() {
      // marker.object3D contains the tracked transform
      const m = marker.object3D;
      const f = frozenCube.object3D;

      // Copy world position + rotation (quaternion) from marker
      m.updateMatrixWorld(true);

      m.getWorldPosition(f.position);
      m.getWorldQuaternion(f.quaternion);

      // Optional: scale
      f.scale.set(1, 1, 1);

      // Hide marker-tracked cube, show frozen cube
      markerCube.setAttribute("visible", "false");
      frozenCube.setAttribute("visible", "true");
    }

    function reset() {
      markerCube.setAttribute("visible", "true");
      frozenCube.setAttribute("visible", "false");
    }

    freezeBtn.addEventListener("click", freezePose);
    resetBtn.addEventListener("click", reset);

    // Optional: auto-freeze once marker has been seen steadily for a moment
    // Uncomment if you want it to freeze automatically.
    /*
    let seenAt = null;
    marker.addEventListener("markerFound", () => { seenAt = performance.now(); });
    marker.addEventListener("markerLost", () => { seenAt = null; });

    function tick() {
      if (seenAt && performance.now() - seenAt > 800 && frozenCube.getAttribute("visible") === false) {
        freezePose();
      }
      requestAnimationFrame(tick);
    }
    tick();
    */
  </script>
</body>

</html>